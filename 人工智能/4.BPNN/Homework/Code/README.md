# BPNN代码结构

## dataLoader.py

数据读入和数据预处理

打开csv文件并返回样本特征和样本标签列表

使用样例：

```python
d = dataLoader('data/train.csv')
data=d.load()
for i in range(5):
    print(data[i])
```

输出：

```python
[1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0.24, 0.2879, 0.81, 0.0, 16.0] # 最后一维是Label
[1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0.22, 0.2727, 0.8, 0.0, 40.0]
[1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0.22, 0.2727, 0.8, 0.0, 32.0]
[1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0.24, 0.2879, 0.75, 0.0, 13.0]
[1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0.24, 0.2879, 0.75, 0.0, 1.0]
```

## dataCutter.py

数据集切分

根据训练/验证集比例划分数据或者根据可选参数分割为n组交叉验证

使用样例：

```python
a = [1, 1, 2, 4, 66, 1, 34, 5, 6, 1, 1,2,31,4121,51,25,1,231,15,84,84,2,13,4,2]
cutter = dataCutter(a, mode='10 cross') # 10组交叉验证模式，返回10组训练/验证集
data=cutter.run()
for d in data:
    print(d)
```

输出：

```python
([2, 84, 25, 6, 13, 34, 1, 66, 84, 1, 51, 4, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [4121, 31])
([4121, 31, 25, 6, 13, 34, 1, 66, 84, 1, 51, 4, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [2, 84])
([4121, 31, 2, 84, 13, 34, 1, 66, 84, 1, 51, 4, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [25, 6])
([4121, 31, 2, 84, 25, 6, 1, 66, 84, 1, 51, 4, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [13, 34])
([4121, 31, 2, 84, 25, 6, 13, 34, 84, 1, 51, 4, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [1, 66])
([4121, 31, 2, 84, 25, 6, 13, 34, 1, 66, 51, 4, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [84, 1])
([4121, 31, 2, 84, 25, 6, 13, 34, 1, 66, 84, 1, 1, 231, 4, 2, 2, 2, 5, 1, 1, 15, 1], [51, 4])
([4121, 31, 2, 84, 25, 6, 13, 34, 1, 66, 84, 1, 51, 4, 4, 2, 2, 2, 5, 1, 1, 15, 1], [1, 231])
([4121, 31, 2, 84, 25, 6, 13, 34, 1, 66, 84, 1, 51, 4, 1, 231, 2, 2, 5, 1, 1, 15, 1], [4, 2])
([4121, 31, 2, 84, 25, 6, 13, 34, 1, 66, 84, 1, 51, 4, 1, 231, 4, 2], [2, 2, 5, 1, 1, 15, 1])
```



## BPNN.py

BPNN主代码，配合`dataLoader`和`dataCutter`使用

主要接口：

```python
def add(self, _type='FC', active_func='sigmoid', hide_width=3, loss_func=None):
    """
    向模型中加入一层神经网络
    :param _type: 该层类型，'FC'表示全连接层，'ACT'表示激活函数层，'OUT'表示输出层
    :param active_func: 激活函数，默认使用'sigmoid'，可用'tanh','relu'代替
    :param hide_width: 宽度，即该层包含多少个节点
    :param loss_func: 当且仅当_type=='OUT'时会使用到，定义模型的损失函数
    :return: None
    """
```

```python
def fit(self, train_data, train_label):
    """
    训练模型
    :param train_data: 训练集
    :param train_label: 训练集标签
    :return: None
    """
```

```python
def run(self, dataset):
    """
    使用当前参数进行一次预测
    :param dataset: 需要预测的样本
    :return: 预测结果->list
    """
```

使用样例：

```python
data = dataLoader('data/train.csv').load()
valid_data = [i[:-1] for i in data]
valid_label = [[i[-1]] for i in data]
model = BPNN(61, opt_mode='MBGD', max_iter=10000, init_func='Xavier', learning_rate=1e-5)
model.add(_type='FC', hide_width=128)
model.add(_type='ACT', active_func='sigmoid')
model.add(_type='OUT', active_func='relu', loss_func='mse')
model.fit(valid_data, valid_label)
```

输出：

```python
Initial Loss: 37604.36774032168
Epoch 10, Loss: 7426.82047281523, Average Epoch Time: 0.074s
Epoch 20, Loss: 5223.375686365283, Average Epoch Time: 0.075s
Epoch 30, Loss: 4892.208045041608, Average Epoch Time: 0.075s
Epoch 40, Loss: 4704.830062235279, Average Epoch Time: 0.075s
Epoch 50, Loss: 4579.928340908473, Average Epoch Time: 0.074s
Epoch 60, Loss: 4523.838075255801, Average Epoch Time: 0.074s
Epoch 70, Loss: 4527.980601723098, Average Epoch Time: 0.073s
Epoch 80, Loss: 4527.126601100546, Average Epoch Time: 0.072s
```



